# LINE通知設定ガイド

![LINE Notify](https://img.shields.io/badge/LINE-Notify-00C300.svg)
![無料](https://img.shields.io/badge/料金-完全無料-brightgreen.svg)
![制限](https://img.shields.io/badge/制限-1000回/月-blue.svg)

日本株ウォッチドッグでLINE通知を受け取るための**完全ガイド**です。初心者の方でも迷わず設定できるよう、画像付きで詳しく説明します。

## 🎯 LINE通知でできること

### 📱 スマホに直接届く株価アラート
- **💰 買い推奨**: 設定条件を満たした銘柄の買いタイミング
- **✅ 利益確定**: 目標利益率に達した銘柄の売りタイミング  
- **⚠️ 損切り**: 損失限界に達した銘柄の緊急売りタイミング
- **🧪 テスト通知**: 設定が正しく動作しているかの確認

### 📊 通知例
```
💰 買い推奨アラート

銘柄: 7203
価格: ¥2,580
戦略: defensive_strategy
時刻: 2025-06-10 14:30:15

【買い推奨】トヨタ自動車 (7203)
現在価格: ¥2,580
理由: 配当利回り 3.2% >= 3.0%, PER 12.1 <= 15.0

---
日本株ウォッチドッグ
```

## 🚀 設定手順（10分で完了）

### ステップ1: LINE Notifyにアクセス

1. **Webブラウザ**で以下のURLにアクセス
   ```
   https://notify-bot.line.me/ja/
   ```

2. **「ログイン」ボタン**をクリック
   - 普段使っているLINEアカウントでログインします
   - QRコードまたはメール・パスワードでログイン可能

### ステップ2: トークンを発行

1. **「マイページ」**をクリック
   - ページ右上のユーザー名をクリック → 「マイページ」を選択

2. **「トークンを発行する」**をクリック
   - 「アクセストークンの発行（開発者向け）」セクションの青いボタン

3. **トークン情報を入力**
   ```
   トークン名: 日本株ウォッチドッグ
   通知を送信するトークルーム: 1:1でLINE Notifyから通知を受け取る
   ```

4. **「発行する」ボタン**をクリック

5. **⚠️ 重要: トークンをコピー**
   ```
   発行されたトークン: abcd1234efgh5678ijkl...
   ```
   - この文字列は**一度しか表示されません**
   - 必ずコピーして保存してください

### ステップ3: アプリにトークンを設定

#### 方法1: 環境変数で設定（推奨・安全）

**Windows の場合:**
```cmd
# コマンドプロンプトで実行
setx LINE_NOTIFY_TOKEN "発行されたトークンをここに貼り付け"

# 例
setx LINE_NOTIFY_TOKEN "abcd1234efgh5678ijkl9012mnop3456"
```

**Linux/macOS の場合:**
```bash
# ターミナルで実行
export LINE_NOTIFY_TOKEN="発行されたトークンをここに貼り付け"

# 例
export LINE_NOTIFY_TOKEN="abcd1234efgh5678ijkl9012mnop3456"

# 永続化（再起動後も有効）
echo 'export LINE_NOTIFY_TOKEN="発行されたトークン"' >> ~/.bashrc
source ~/.bashrc
```

#### 方法2: 設定ファイルで設定

1. **`config/settings.json`** ファイルを開く

2. **LINE設定を編集**
   ```json
   {
     "notifications": {
       "email": {
         "enabled": false
       },
       "desktop": {
         "enabled": true
       },
       "console": {
         "enabled": true
       },
       "line": {
         "enabled": true,
         "token": "発行されたトークンをここに貼り付け"
       }
     }
   }
   ```

3. **ファイルを保存**

### ステップ4: 動作確認

#### GUIでのテスト（簡単）

1. **アプリを起動**
   ```bash
   python src/main.py --gui
   ```

2. **「ポートフォリオ」タブ**を開く

3. **「LINEテスト」ボタン**をクリック

4. **LINEアプリで通知確認**
   - スマホのLINEアプリを開く
   - 「LINE Notify」からメッセージが届いているか確認

#### コマンドラインでのテスト

```bash
# 仮想環境を有効化
source .venv/bin/activate

# LINE通知テスト実行
python test_line_notification.py
```

**成功例:**
```
==================================================
LINE通知機能テスト
==================================================
LINE通知設定: 有効
トークン設定: あり

LINE通知テストを実行中...
LINE通知送信完了: テスト - 7203
✅ LINE通知テスト完了
LINEアプリで通知を確認してください
==================================================
```

## 🔧 トラブルシューティング

### よくある問題と解決方法

#### ❌ 問題1: 「トークンが設定されていません」エラー

**症状:**
```
❌ LINE Notifyトークンが設定されていません
```

**解決方法:**
1. トークンが正しく設定されているか確認
2. 環境変数の場合、コマンドプロンプト/ターミナルを再起動
3. 設定ファイルの場合、JSON形式が正しいか確認

**確認コマンド:**
```bash
# Windows
echo %LINE_NOTIFY_TOKEN%

# Linux/macOS  
echo $LINE_NOTIFY_TOKEN
```

#### ❌ 問題2: 「LINE通知が無効になっています」エラー

**症状:**
```
❌ LINE通知が無効になっています
```

**解決方法:**
`config/settings.json` で以下を確認:
```json
"line": {
  "enabled": true,  ← これが true になっているか
  "token": "..."
}
```

#### ❌ 問題3: 「HTTP 401 - Invalid access token」エラー

**症状:**
```
LINE通知送信エラー: HTTP 401 - Invalid access token
```

**解決方法:**
1. トークンが間違っている可能性
2. LINE Notifyで新しいトークンを再発行
3. 発行時に表示される長い文字列をそのまま使用

#### ❌ 問題4: 「HTTP 429 - Rate limit exceeded」エラー

**症状:**
```
LINE通知送信エラー: HTTP 429 - Rate limit exceeded
```

**解決方法:**
- 月間1,000回の制限に達した
- 翌月まで待つか、アラート頻度を下げる

#### ❌ 問題5: LINEに通知が届かない

**解決手順:**
1. **LINE Notifyが友だちに追加されているか確認**
   - LINEアプリで「LINE Notify」を検索
   - 友だち追加されていない場合は追加

2. **通知設定を確認**
   - LINEアプリ → 設定 → 通知 → 「LINE Notify」が有効か

3. **トークルーム設定を確認**
   - トークン発行時の送信先設定
   - 「1:1でLINE Notifyから通知を受け取る」が推奨

## 📊 料金・制限について

### 💰 料金
- **完全無料**（個人利用）
- アカウント作成費用: **¥0**
- API利用料金: **¥0**

### 📈 利用制限
- **月間1,000回まで**のAPI呼び出し
- **1メッセージ1,000文字まで**
- **グループ送信**: 無制限

### 🎯 実際の使用量
株価監視での想定使用量:
```
- 買いアラート: 月10回程度
- 売りアラート: 月10回程度  
- テスト通知: 月5回程度
- 合計: 月25回程度（制限の2.5%）
```

**→ 個人投資用途では制限に引っかかることはほぼありません**

## 🔒 セキュリティ・プライバシー

### ✅ 安全な点
- **LINE公式サービス**: LINEが提供する公式API
- **認証制御**: トークンベースの安全な認証
- **プライバシー保護**: 個人情報は送信されません

### ⚠️ 注意点
- **トークンの管理**: トークンは他人に教えないでください
- **共有PC**: 設定ファイルにトークンを書く場合は注意
- **環境変数推奨**: 可能な限り環境変数での設定を推奨

### 🛡️ 推奨セキュリティ設定
1. **環境変数でトークン管理**（設定ファイルより安全）
2. **定期的なトークン再発行**（3-6ヶ月毎）
3. **不要になったトークンは削除**

## 📱 使用例・活用方法

### 🌅 朝の投資ルーティン
```
09:00 - 市場開場前に設定確認
09:30 - 株価監視開始
10:00 - 最初のアラートチェック
```

### 📊 投資戦略別設定例

#### 守備的投資（配当重視）
- 配当利回り3%以上で買いアラート
- 利益確定15%、損切り-8%

#### 成長株投資（キャピタルゲイン重視）  
- PER25倍以下で買いアラート
- 利益確定30%、損切り-15%

### 📈 効果的な活用法
1. **複数デバイス対応**: スマホ・タブレット・PCで同時受信
2. **グループ共有**: 家族用投資グループで情報共有
3. **バックアップ通知**: メール通知との併用で確実性向上

## 🎓 上級者向けカスタマイズ

### 🔧 メッセージフォーマット変更
`src/alert_manager.py` の `_send_line_notification()` を編集:

```python
# カスタムメッセージフォーマット例
message = f"""
🚀 {alert_type_text}シグナル

📊 {alert.symbol} | ¥{alert.triggered_price:,.0f}
📈 戦略: {alert.strategy_name}
⏰ {alert.timestamp.strftime('%H:%M:%S')}

{alert.message.replace('\\n', '\n')}

💡 投資判断はご自身の責任で行ってください
""".strip()
```

### 📊 複数アカウント設定
異なる投資戦略用に複数のLINE Notifyトークンを設定:

```json
{
  "notifications": {
    "line_defensive": {
      "enabled": true,
      "token": "守備的戦略用トークン"
    },
    "line_growth": {
      "enabled": true, 
      "token": "成長株戦略用トークン"
    }
  }
}
```

## 🆘 サポート・問い合わせ

### 🔍 問題解決の流れ
1. **このガイドのトラブルシューティングを確認**
2. **テストコマンドでエラー詳細を確認**
3. **設定ファイルの内容を再確認**
4. **新しいトークンで再試行**

### 📞 サポートリソース
- **LINE Notify公式**: https://notify-bot.line.me/ja/
- **アプリのテストツール**: `python test_line_notification.py`
- **GitHub Issues**: バグ報告・機能要望

### 💬 よくある質問（FAQ）

**Q: 通知が来すぎて困る場合は？**
A: `config/strategies.json` でアラート条件を厳しく設定してください

**Q: 家族と通知を共有したい場合は？**
A: LINEグループを作成し、トークン発行時にそのグループを選択

**Q: 会社のPCで使う場合の注意点は？**
A: 環境変数での設定を推奨、設定ファイルにトークンを残さない

**Q: スマホの通知音を変更したい場合は？**
A: LINEアプリ → 設定 → 通知 → 通知音設定

---

## ✅ 設定完了チェックリスト

- [ ] LINE Notifyでトークンを発行した
- [ ] トークンをアプリに設定した（環境変数 or 設定ファイル）
- [ ] `config/settings.json` で `line.enabled: true` に設定した
- [ ] テスト通知を送信して、LINEで受信確認した
- [ ] 投資戦略に合わせてアラート条件を調整した

**🎉 設定完了！これで株価アラートがLINEで受け取れます！**

---

**⚠️ 投資に関する注意事項**

このツールは投資の参考情報を提供するものであり、投資助言を行うものではありません。最終的な投資判断は必ずご自身の責任で行ってください。株式投資には元本割れのリスクがあります。